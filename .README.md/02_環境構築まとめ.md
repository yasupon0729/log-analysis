# 環境構築まとめ - ログ解析アプリケーション

## 🎯 概要
S3から直接JSONログを取得し、テーブル表示するアプリケーションの環境構築手順です。
ダーク・青基調のUIで、認証・DB不要のシンプルな構成を採用します。

## 🧱 必要な技術スタック

### ランタイム・フレームワーク
- **Runtime**: Bun (最新版)
- **Framework**: Next.js v15 (App Router)
- **Language**: TypeScript

### UI・スタイリング
- **CSS**: Panda CSS (ダーク固定・青基調テーマ)
- **Table**: TanStack Table (仮想化対応)
- **Components**: 必要に応じて追加

### 開発ツール
- **Linter/Formatter**: Biome
- **Environment**: WSL (Windows Subsystem for Linux)

## 📝 前提条件

### システム要件
- WSL2がインストール済み（Windows環境の場合）
- Node.js 18.18以上（Bunが内部で使用）
- Git

### AWS関連
- AWS CLIがインストール済み（オプション）
- S3アクセス用のIAMユーザー作成済み
- 以下の権限を持つIAMポリシー設定済み：
  - `s3:ListBucket` (prefix: `logs/`)
  - `s3:GetObject` (`logs/`配下)

## 🚀 セットアップ手順

### 1. Bunのインストール

```bash
# WSL環境での実行を推奨
curl -fsSL https://bun.sh/install | bash

# インストール確認
bun --version
```

### 2. プロジェクトの作成

```bash
# プロジェクトディレクトリ作成
mkdir log-analysis-app
cd log-analysis-app

# Next.js 15プロジェクトの初期化
bunx create-next-app@latest .
# 設定プロンプトの推奨選択：
# ✔ Would you like to use ESLint? Biomeを選択
# ✔ Would you like to use Tailwind CSS? … No (Panda CSSを使用するため)
```

### 3. Panda CSSのセットアップ

```bash
# Panda CSSインストール
bun add -D @pandacss/dev
bun add @pandacss/preset-panda

# Panda CSS初期化
bunx panda init --postcss

# panda.config.tsの設定（ダーク・青基調テーマ）
```

`panda.config.ts`の基本設定:
```typescript
import { defineConfig, defineGlobalStyles } from '@pandacss/dev'

export default defineConfig({
  preflight: true,
  include: ['./app/**/*.{ts,tsx,js,jsx}', './components/**/*.{ts,tsx,js,jsx}'],
  exclude: [],
  theme: {
    extend: {
      tokens: {
        colors: {
          primary: {
            50: { value: '#e6f2ff' },
            100: { value: '#bae3ff' },
            200: { value: '#7cc4fa' },
            300: { value: '#47a3f3' },
            400: { value: '#2186eb' },
            500: { value: '#0967d2' },
            600: { value: '#0552b5' },
            700: { value: '#03449e' },
            800: { value: '#01337d' },
            900: { value: '#002159' },
          },
          dark: {
            bg: { value: '#0f172a' },
            surface: { value: '#1e293b' },
            border: { value: '#334155' },
            text: { value: '#e2e8f0' },
            textMuted: { value: '#94a3b8' },
          }
        }
      },
      semanticTokens: {
        colors: {
          background: { value: { base: '{colors.dark.bg}' } },
          surface: { value: { base: '{colors.dark.surface}' } },
          border: { value: { base: '{colors.dark.border}' } },
          text: { value: { base: '{colors.dark.text}' } },
          textMuted: { value: { base: '{colors.dark.textMuted}' } },
        }
      }
    }
  },
  globalCss: defineGlobalStyles({
    body: {
      bg: 'background',
      color: 'text',
      fontFamily: 'system-ui, -apple-system, sans-serif',
    }
  }),
  outdir: 'styled-system',
})
```

### 4. TanStack Tableのインストール

```bash
# TanStack Table v8
bun add @tanstack/react-table @tanstack/react-virtual
```

### 5. Biomeのセットアップ

```bash
# Biomeインストール
bun add -D @biomejs/biome

# Biome初期化
bunx biome init

# biome.jsonの設定
```

`biome.json`の基本設定:
```json
{
  "formatter": {
    "enabled": true,
    "indentStyle": "space",
    "indentWidth": 2,
    "lineWidth": 100
  },
  "linter": {
    "enabled": true,
    "rules": {
      "recommended": true
    }
  },
  "organizeImports": {
    "enabled": true
  }
}
```

### 6. AWS SDKのインストール

```bash
# AWS SDK v3
bun add @aws-sdk/client-s3
```

### 7. その他の依存パッケージ

```bash
# 日付処理
bun add date-fns

# エラーハンドリング
bun add zod

# 開発用ツール
bun add -D @types/node
```

### 8. 環境変数の設定

`.env.local`ファイルを作成:

```bash
# S3設定
S3_REGION=ap-northeast-1
S3_BUCKET=gexel-secure-storage
S3_PREFIX=logs/
AWS_ACCESS_KEY_ID=your_access_key_here
AWS_SECRET_ACCESS_KEY=your_secret_key_here

# アプリ設定
NEXT_PUBLIC_APP_NAME=Log Analysis Dashboard
NEXT_PUBLIC_MAX_LOGS_PER_REQUEST=10000
```

### 9. プロジェクト構造の準備

```bash
# ディレクトリ構造作成
mkdir -p app/api/logs
mkdir -p components/{ui,features,layouts}
mkdir -p lib/{aws,utils}
mkdir -p types
```

推奨ディレクトリ構造:
```
log-analysis-app/
├── app/
│   ├── api/
│   │   └── logs/
│   │       └── route.ts
│   ├── layout.tsx
│   ├── page.tsx
│   └── globals.css
├── components/
│   ├── ui/
│   │   ├── Table.tsx
│   │   ├── DatePicker.tsx
│   │   └── FilterBar.tsx
│   ├── features/
│   │   └── LogViewer.tsx
│   └── layouts/
│       └── MainLayout.tsx
├── lib/
│   ├── aws/
│   │   └── s3-client.ts
│   └── utils/
│       ├── log-parser.ts
│       └── data-normalizer.ts
├── types/
│   └── log.ts
├── styled-system/
├── .env.local
├── biome.json
├── panda.config.ts
├── package.json
└── tsconfig.json
```

## 🧪 開発サーバーの起動

```bash
# Pandaのビルド
bunx panda

# 開発サーバー起動
bun dev

# ブラウザで確認
# http://localhost:3000
```

## 📦 本番ビルド

```bash
# ビルド
bun run build

# 本番サーバー起動
bun run start
```

## 🔧 package.jsonスクリプト設定

```json
{
  "scripts": {
    "dev": "bunx panda --watch & next dev",
    "build": "bunx panda && next build",
    "start": "next start",
    "lint": "bunx biome check ./",
    "format": "bunx biome format --write ./",
    "type-check": "tsc --noEmit"
  }
}
```

## ⚠️ 注意事項

### セキュリティ
- AWS認証情報は必ず環境変数で管理
- `.env.local`は絶対にGitにコミットしない
- S3アクセスは必ずサーバーサイド（API Route）経由で実行

### パフォーマンス
- 大量データ表示時はTanStack Tableの仮想化を活用
- S3からの取得は必要最小限に制限（日付指定など）

### 開発環境
- WSL環境推奨（Windows環境の場合）
- Bunの高速性を活かすため、npm/yarnは使用しない

## 🚨 トラブルシューティング

### Bunインストール失敗時
```bash
# 手動インストール
curl -fsSL https://bun.sh/install | bash -s "bun-v1.0.0"
```

### Panda CSSビルドエラー時
```bash
# キャッシュクリア
rm -rf styled-system
bunx panda codegen
```

### S3接続エラー時
- AWS認証情報の確認
- IAMポリシーの権限確認
- リージョン設定の確認

## 📚 参考リンク
- [Bun Documentation](https://bun.sh/docs)
- [Next.js 15 Documentation](https://nextjs.org/docs)
- [Panda CSS Documentation](https://panda-css.com/docs)
- [TanStack Table Documentation](https://tanstack.com/table/latest)
- [Biome Documentation](https://biomejs.dev/)